<style>
  .source,
  .output {
    height: 300px;
  }

  .source textarea{
    width: 100%;
    height: 100%;
  }

  .left, .right{
    width:500px;
    float:left;
  }


</style>

<body>
  <div>
      <button id="run">点击转换</button>
  </div>
  

  
  
  <div class="left source">
    <h2>请输入源码：</h2>
    <textarea id="source"></textarea>
  </div>

  <div class="right">
      <h2>结果:</h2>
      <pre id="output">
        
      </pre>
  </div>

  <script>
    var run = document.getElementById('run')
    var output = document.getElementById('output')
    var source = document.getElementById('source')
    var demo = `
/**
* id
**/
1: i64 id
/**
* 名称
**/
2: string name
/**
* 数量
**/
3: i32 number
/**
* 邮箱
**/
4: string email
`
  source.value = demo;
    run.addEventListener('click', function () {
      var src = source.value;
      output.innerText = parse(src);
    })

    function trim(str){
      return (str + '').trim()
    }

    function parse(str) {
      let commentRegexp = /\/\*\*([\s\S]+?)\*\*\//g;
      let titles = [];
      str = str.replace(commentRegexp, function (s, match) {
        match = match.replace('*', '');
        titles.push(trim(match))
        return '';
      });
      let lines = str.split('\n').filter(item => trim(item).length > 0)
      let obj = {}
      console.log(lines)
      lines.forEach((item, index) => {
        item = trim(item);
        item = item.substr(1, item.length - 1);
        item = item.split(' ');
        let key = trim(item[2]);
        let type = item[1];
        obj[key] = {
          title: titles[index],
          type: /i[0-9]+/.test(type) ? 'number' : 'string'
        }
      })
      console.log(obj)
      return JSON.stringify(obj,null,2)

    }
  </script>
</body>
